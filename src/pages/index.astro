---
import { PortfolioService } from "../services/PortfolioService.js";
const svc = new PortfolioService();
const projects = await svc.listProjects();
const experience = await svc.listExperience();
---

<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>khosilmurod abdukholikov — engineer</title>
  <meta name="description" content="minimal, fast personal site for a developer." />
  <meta name="generator" content={Astro.generator} />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .highlight {
      background: linear-gradient(to bottom, transparent 60%, rgba(34, 197, 94, 0.3) 60%);
      padding: 0 0.125rem;
      border-radius: 0.125rem;
    }
    .dark .highlight {
      background: linear-gradient(to bottom, transparent 60%, rgba(34, 197, 94, 0.4) 60%);
    }
  </style>
  <script>
    // Dark mode initialization - runs before the page loads to prevent flash
    (function() {
      const theme = localStorage.getItem('theme') || 
                   (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>
<body class="bg-white text-zinc-900 dark:bg-zinc-900 dark:text-zinc-100 antialiased transition-colors">
  <!-- Dark mode toggle -->
  <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
    <svg id="sun-icon" class="hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
    </svg>
    <svg id="moon-icon" class="" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
    </svg>
  </button>

  <!-- header -->
  <header class="sticky top-0 z-20 border-b border-zinc-300/30 dark:border-zinc-600/30 backdrop-blur bg-white/80 dark:bg-zinc-900/80" style="border-bottom-width: 0.5px;">
    <div class="mx-auto w-full max-w-[var(--container)] px-5 py-3 flex items-center">
      <a href="#top" class="flex items-center gap-2 hover:opacity-80">
        <span class="inline-block h-5 w-5 rounded-md bg-zinc-900 dark:bg-zinc-100"></span>
        <span class="text-sm">khosilmurod</span>
      </a>
      <div class="flex-1"></div>
      <nav class="text-sm flex items-center gap-6">
        <a href="#about" class="hover:opacity-80">about</a>
        <a href="#projects" class="hover:opacity-80">projects</a>
        <a href="#experience" class="hover:opacity-80">experience</a>
        <a href="#writing" class="hover:opacity-80">writing</a>
        <a href="#contact" class="hover:opacity-80">contact</a>
      </nav>
    </div>
  </header>

  <main id="top" class="mx-auto w-full max-w-[var(--container)] px-5">
    <!-- hero / about -->
    <section id="about" class="py-10 md:py-12 space-y-3">
      <p class="section-title">software engineer</p>
      <p class="text-base text-zinc-600 dark:text-zinc-300 max-w-prose">i am a computer science student at yale university. my work focuses on <span class="highlight">software engineering</span>, <span class="highlight">systems programming</span>, and <span class="highlight">ai infrastructure</span> (especially backend services in c++ and python). i would like to help build the backend systems and infrastructure that power large-scale products, from core services to ai platforms.</p>
    </section>

    <!-- experience -->
    <section id="experience" class="py-10 md:py-12 space-y-6">
      <p class="section-title">experience</p>
      <ul class="space-y-3">
        {experience.map(exp => (
          <li class="flex justify-between text-sm">
            <span class="font-medium">{exp.company}</span>
            <span class="text-zinc-500">{exp.role} · {exp.year}</span>
          </li>
        ))}
      </ul>
    </section>

    <!-- projects -->
    <section id="projects" class="py-10 md:py-12 space-y-4">
      <p class="section-title">projects</p>
      <div id="project-list" class="grid md:grid-cols-2 gap-6">
        {projects.slice(0, 4).map(project => (
          <article class="group rounded-xl p-4 bg-white/70 dark:bg-zinc-800/50 border border-black/5 dark:border-white/10">
            <h3 class="font-medium">{project.title}</h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-400 mt-1">{project.description}</p>
          </article>
        ))}
        {projects.slice(4).map(project => (
          <article class="group hidden rounded-xl p-4 bg-white/70 dark:bg-zinc-800/50 border border-black/5 dark:border-white/10">
            <h3 class="font-medium">{project.title}</h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-400 mt-1">{project.description}</p>
          </article>
        ))}
      </div>
      {projects.length > 4 && (
        <div class="flex justify-center mt-4">
          <button id="show-more" class="text-sm text-zinc-600 dark:text-zinc-300 hover:opacity-80 flex items-center gap-1">
            <span>more projects</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </div>
      )}
    </section>

    <!-- writing -->
    <section id="writing" class="py-10 md:py-12 space-y-3">
      <p class="section-title">writing</p>
      <ul class="space-y-2 text-sm">
        <li><a href="#" class="hover:underline">how i designed yale-gpt to feel fast and simple</a></li>
        <li><a href="#" class="hover:underline">what i learned from modifying an operating system</a></li>
        <li><a href="#" class="hover:underline">building tools for communities without internet</a></li>
      </ul>
    </section>

    <!-- contact -->
    <section id="contact" class="py-10 md:py-12 space-y-3">
      <p class="section-title">contact</p>
      <p class="max-w-prose text-zinc-700 dark:text-zinc-300">say hi at <a href="mailto:m.abdukholikov@yale.edu" class="underline hover:opacity-80">m.abdukholikov@yale.edu</a> or find me on <a href="https://linkedin.com/in/khosilmurod" class="hover:underline">linkedin</a> and <a href="https://github.com/khosilmurod" class="hover:underline">github</a>.</p>
    </section>

    <footer class="py-8 text-xs text-zinc-500 dark:text-zinc-400">
      <p>© 2025 · minimal build. no tracking. deployed on vercel.</p>
    </footer>
  </main>

  <script>
    // Show more projects functionality
    const btn = document.getElementById('show-more');
    const projects = document.querySelectorAll('#project-list .hidden');
    if (btn) {
      btn.addEventListener('click', () => {
        projects.forEach(p => p.classList.remove('hidden'));
        btn.style.display = 'none';
      });
    }

    // Dark mode toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    
    function updateThemeIcons() {
      if (document.documentElement.classList.contains('dark')) {
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      } else {
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      }
    }

    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeIcons();
    }

    // Initialize theme icons
    updateThemeIcons();
    
    // Add click listener
    themeToggle.addEventListener('click', toggleTheme);

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        if (e.matches) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
        updateThemeIcons();
      }
    });
  </script>
</body>
</html>
